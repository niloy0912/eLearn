{% extends "core/base.html" %}

{% block title %}Course Details{% endblock %}

{% block content %}
<div class="course-container">
    <h2>{{ course.title }}</h2>
    <p>{{ course.description }}</p>
    <p><strong>Teacher:</strong> {{ course.teacher.username }}</p>

    <h3>Assignments</h3>
    <ul>
        {% for assignment in assignments %}
            <li>
                <a href="{% url 'assignments:assignment_detail' assignment.pk %}">{{ assignment.title }}</a>
                {% if request.user == course.teacher %}
                    - <a href="{% url 'assignments:assignment_update' assignment.pk %}" class="btn">Edit</a>
                    - <a href="{% url 'assignments:assignment_delete' assignment.pk %}" class="btn">Delete</a>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    {% if request.user == course.teacher %}
        <a href="{% url 'assignments:assignment_create' %}?course_id={{ course.pk }}" class="btn">Create New Assignment</a>
    {% endif %}

    <h3>Enrolled Students</h3>
    <ul>
        {% for enrollment in enrolled_students %}
            <li>{{ enrollment.student.username }}</li>
        {% endfor %}
    </ul>

    {% if request.user.is_authenticated %}
        {% if error_message %}
            <p class="error-message">{{ error_message }}</p>
        {% endif %}
        {% if is_enrolled %}
            <p>You are already enrolled in this course.</p>
        {% else %}
            <form method="post" action="{% url 'courses:enroll_in_course' course.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn">Enroll</button>
            </form>
        {% endif %}
    {% endif %}

    {% if request.user == course.teacher %}
        <a href="{% url 'courses:course_update' course.pk %}" class="btn">Edit</a> |
        <a href="{% url 'courses:course_delete' course.pk %}" class="btn">Delete</a>
    {% endif %}
</div>
{% endblock %}
